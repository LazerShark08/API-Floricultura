<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Login - Floricultura</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>

<div class="aero-bg"></div>
<div class="lens-flare"></div>
<div class="aero-ambient"></div>

<div class="bubbles">
  <div class="bubble" style="--size:60px; --time:18s; --drift:20px; left:10%;"></div>
  <div class="bubble" style="--size:40px; --time:22s; --drift:-15px; left:25%;"></div>
  <div class="bubble" style="--size:80px; --time:17s; --drift:30px; left:40%;"></div>
  <div class="bubble" style="--size:55px; --time:26s; --drift:-25px; left:60%;"></div>
  <div class="bubble" style="--size:70px; --time:19s; --drift:35px; left:75%;"></div>
</div>

<header class="site-header">
    <div class="brand">
        <div class="logo-gloss"><span>Flori</span><strong>Bloom</strong></div>
        <div class="tag">Flores frescas • Entrega rápida ✿</div>
    </div>

    <nav class="nav">
        <a href="index.html">Home</a>
        <a href="cart.html">Carrinho</a>
        <a href="login.html">Login</a>
    </nav>
</header>

<div class="container auth">
  <div class="login-box">
    <h2>Entrar</h2>

    <input type="email" id="email" placeholder="Seu e-mail">
    <input type="password" id="password" placeholder="Senha">

    <button class="btn" id="login-btn">Entrar</button>

    <p class="alt-link">
      Não tem conta? <a href="#" id="show-register">Registre-se</a>
    </p>
  </div>

  <div class="login-box" id="register-box" style="display:none;">
    <h2>Criar conta</h2>

    <input type="text" id="reg-name" placeholder="Seu nome">
    <input type="email" id="reg-email" placeholder="Seu e-mail">
    <input type="password" id="reg-password" placeholder="Senha">

    <button class="btn" id="register-btn">Criar conta</button>

    <p class="alt-link">
      Já tem conta? <a href="#" id="show-login">Entrar</a>
    </p>
  </div>
</div>

<script>
document.getElementById("login-btn").onclick = async () => {
  const email = document.getElementById("email").value;
  const password = document.getElementById("password").value;

  const resp = await fetch('/users/login', {
    method: 'POST',
    headers: { "Content-Type":"application/json" },
    body: JSON.stringify({ email, password })
  });

  const data = await resp.json();
  if (data.token){
    localStorage.setItem("token", data.token);
    window.location.href = "index.html";
  } else {
    alert("Login inválido.");
  }
};

document.getElementById("register-btn").onclick = async () => {
  const name = document.getElementById("reg-name").value;
  const email = document.getElementById("reg-email").value;
  const password = document.getElementById("reg-password").value;

  const resp = await fetch('/users/register', {
    method: 'POST',
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ name, email, password })
  });

  const data = await resp.json();

  if (resp.ok) {
    alert("Conta criada com sucesso! Agora faça login.");
    document.getElementById("register-box").style.display = "none";
    document.querySelector(".login-box").style.display = "block";
  } else {
    alert("Erro ao criar conta: " + (data.error || "Erro desconhecido"));
  }
};

// alternar login/cadastro
document.getElementById("show-register").onclick = () => {
  document.querySelector(".login-box").style.display = "none";
  document.getElementById("register-box").style.display = "block";
};

document.getElementById("show-login").onclick = () => {
  document.querySelector(".login-box").style.display = "block";
  document.getElementById("register-box").style.display = "none";
};
</script>

</body>
</html>